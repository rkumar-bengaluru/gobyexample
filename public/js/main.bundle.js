(()=>{"use strict";(()=>{let e={},t=e;const n=e;t.create=function(e,t,n,o){let s=document.createElement(e||"div");return t&&(s.className=t),n&&(n instanceof HTMLElement?s.appendChild(n):s.innerHTML=n),o&&o.appendChild(s),s},t.copy=function(e,t){for(let n in t)e[n]=t[n];return e},t.createCM=function(e,n={},o="100%",s="100%"){let l=t.copy({lineNumbers:!1,tabSize:3,indentWithTabs:!0,specialChars:/[ \u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b-\u200f\u2028\u2029\ufeff]/,specialCharPlaceholder:e=>t.create("span"," "===e?"cm-space":"cm-special"," ")},n);return CodeMirror(e,l)},t.decomposeRegEx=function(e,t="/"){let n=new RegExp("^"+t+"(.*)"+t+"([igmsuUxy]*)$").exec(e);return n?{source:n[1],flags:n[2]}:{source:e,flags:"g"}},t.query=function(e,n=document.body){return">"===e[0]?t._childQuery(e,n,t.query):n.querySelector(e)},t._childQuery=function(e,t,n){t.id||(t.id="___tmp_id");let o=n("#"+t.id+" "+e,t.parentNode);return"___tmp_id"===t.id&&(t.id=""),o};class o{get expression(){return this._expression}set expression(e){this._expression=e}get textcm(){return this._textcm}set textcm(e){this._textcm=e}get result(){return this._result}set result(e){this._result=e}get match(){let e=this._getRegex(this._expression);e&&(console.log("finding patterns..."),this._match(e,this._textcm,this._result))}_match(e,t,n){let o,s,l,i,r,c=0,a=0;for(s=new Date;null!==(o=e.exec(t.getValue()));){let e=t.posFromIndex(o.index);r=e.line,a=e.ch;var g=a+o[0].length;if(t.markText({line:e.line,ch:a},{line:e.line,ch:g},{className:"styled-background"}),c++,l=new Date,i=Math.abs(s-l)/1e3,i>2)break}n.innerHTML=i>2?"Found "+c+" matches @ "+i+" seconds. Backtracking Detected":"Found "+c+" matches @ "+i+" seconds."}_getRegex(e){if(!e.match(/^\/.+[^\\]\/[a-z]*$/gi))return console.log("!exp.match(/^/.+[^\\]/[a-z]*$/ig)"),null;if(e.length<3)return console.log("exp.length < 3"),null;console.log("_getRegex(str)->"+e.length);let t=e.match(/^\/(.+)\/([a-z]+)?$/),n=null;console.log("_getRegex(str)...");try{console.log("_getRegex(str)...in try"),n=t?new RegExp(t[1],t[2]||""):new RegExp(e,"g"),console.log("_getRegex(str)...in last")}catch(e){console.log(e)}return console.log("_getRegex(str)...returning..."),n}}class s{constructor(e){this.delim="/",this.text=e,this.matchPattern=new o,this.initUI()}decomposeRegEx(e,t="/"){let n=new RegExp("^"+t+"(.*)"+t+"([igmsuUxy]*)$").exec(e);return n?{source:n[1],flags:n[2]}:{source:e,flags:"g"}}set value(e){console.log("value(expression)");let t=this.decomposeRegEx(e||s.DEFAULT_EXPRESSION,this.delim);this.pattern=t.source,this.flags=t.flags}get value(){return console.log("value()"),this.editor.getValue()}set pattern(e){console.log("set pattern()");let t=this.editor.getValue().lastIndexOf(this.delim);this.editor.replaceRange(e,{line:0,ch:1},{line:0,ch:t}),console.log("setting pattern"),this.deferUpdate()}initUI(){this.editorEl=document.getElementById("expressionInput");let e=this.editor=n.createCM(this.editorEl,{autofocus:!0,maxLength:2500,singleLine:!0});e.on("mousedown",((e,t)=>this.onEditorMouseDown(e,t))),e.on("change",((e,t)=>this.onEditorChange(e,t))),e.on("keydown",((e,t)=>this.onEditorKeyDown(e,t))),e.toggleOverwrite=()=>{},this.setInitialExpression(),e.setSize(500,50),this.value=s.DEFAULT_EXPRESSION,this.text.expmon=this.editor}onEditorMouseDown(e,t){console.log("_onEditorMouseDown->")}onEditorKeyDown(e,t){console.log("evt.ctrlKey->"+t.ctrlKey),(t.ctrlKey||t.metaKey)&&68==t.keyCode&&(t.preventDefault(),this.pattern="")}onEditorChange(e,t){console.log("onEditorChange(cm, evt)"),document.getElementById("result").innerHTML="Processing... ",document.getElementById("expressiontotest").innerHTML=e.getValue(),this.deferUpdate();let n=t.text[0];console.log(t.from.ch+","+t.to.ch+","+t.text[0]+","+t.removed+","+t.origin),this.matchPattern.expression=e.getValue(),this.matchPattern.textcm=this.text.cm,this.matchPattern.result=document.getElementById("result"),this.matchPattern.match,n.length<3||!n.match(/^\/.+[^\\]\/[a-z]*$/gi)||1!==t.from.ch||t.to.ch!=1+t.removed[0].length?console.log("returning..."):(console.log("setting value..."),this.value=n)}charRect(e,t){if(null==t)return null;let n=e.posFromIndex(t),o=e.charCoords(n);return console.log(n),o.x=o.left,o.y=o.top,o.width=o.right-o.left,o.height=o.bottom-o.top,o}matchPattern(e,t){let n,o=0;var s,l,i;s=new Date;let r=this.text.cm,c=0,a=0;for(;null!==(n=e.exec(t));){o++,l=new Date,i=Math.abs(s-l)/1e3;let e=r.posFromIndex(n.index);a=e.line,c=e.ch;var g=c+n[0].length;if(console.log(e),console.log("marking line->"+e.line+", charAt->"+c+",len->"+g),r.markText({line:e.line,ch:c},{line:e.line,ch:g},{className:"styled-background"}),i>2)break}console.log("result size->"+o),document.getElementById("result").innerHTML=i>2?"Found "+o+" matches @ "+i+" seconds. Backtracking Detected":"Found "+o+" matches @ "+i+" seconds."}deferUpdate(){console.log("deferUpdate")}update(){console.log("update")}getRegex(e,t){if(!e.match(/^\/.+[^\\]\/[a-z]*$/gi))return console.log("!str.match(/^/.+[^\\]/[a-z]*$/ig)"),null;if(e.length<3)return console.log("str.length < 3"),null;console.log("getRegex(str)->"+e.length);let n=e.match(/^\/(.+)\/([a-z]+)?$/),o=null;console.log("getRegex(str)...");try{console.log("getRegex(str)...in try"),o=n?new RegExp(n[1],n[2]||""):new RegExp(e,"g"),console.log("getRegex(str)...in last")}catch(e){console.log(e)}return console.log("getRegex(str)...returning..."),o}setInitialExpression(){console.log("setInitialExpression(str)");let e=this.editor;e.setValue("/./g"),e.getDoc().markText({line:0,ch:0},{line:0,ch:1},{className:"exp-decorator",readOnly:!0,atomic:!0,inclusiveLeft:!0}),e.getDoc().markText({line:0,ch:2},{line:0,ch:4},{className:"exp-decorator",readOnly:!1,atomic:!0,inclusiveRight:!0}),this.deferUpdate()}}s.DEFAULT_EXPRESSION="\\b[A-Z].*?\\b";let l=new class{constructor(e){this.delim="/",this.matchPattern=new o,this.init()}get cm(){return console.log("get code monitor()"),this.editor}set expmon(e){console.log("set setExpMon(expmon)"+e),this._expmon=e}init(){console.log("TestText init()"),this.editorEl=document.getElementById("editor"),this.editor=CodeMirror.fromTextArea(this.editorEl,{lineNumbers:!0,styleSelectedText:!0}),this.editor.on("change",((e,t)=>this.onTextEditorChange(e,t))),this.editor.setValue(this.editorEl.value)}onTextEditorChange(e,t){console.log("onTextEditorChange(cm, evt)"+this._expmon),document.getElementById("result").innerHTML="Processing... ",this._expmon&&(console.log("finding..."),this.matchPattern.expression=this._expmon.getValue(),this.matchPattern.textcm=e,this.matchPattern.result=document.getElementById("result"),this.matchPattern.match)}};new s(l)})()})();
//# sourceMappingURL=main.bundle.js.map